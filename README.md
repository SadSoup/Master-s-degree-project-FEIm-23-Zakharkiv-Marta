# Дослідження впливу гіперпараметрів глибоких згорткових нейронних мереж на процес їхнього навчання
## _Практична частина магістерської роботи_
### _Виконала студентка групи ФеІм-23 Захарків Марта_

## Опис файлів

В результаті виконання роботи було створено 5 файлів: `data_preparation.py`, `train.py`, `model.h5`, `test.py` та `interface.py`.

Також на репозиторії можна побачити папку `images` та файл `requirements.txt`.

`images` – папка із зображення собак шести порід. Ця папка містить три підпапки: `train` – папка із зображеннями, на яких навчається модель, `validation` – папка із зображеннями, які використовуються для перевірки точності розпізнавання моделі на нових даних протягом навчання, `test` – папка із зображеннями, які використовуються для перевірки точності розпізнавання моделі на нових даних після завершення навчання. В кожній з цих підпапок є ще папки. Кожна така папка зберігає зображення лише певної породи.

`data_preparation.py` – скрипт, який перетворює зображення із папки `images` в масиви `NumPy`. Також він виділяє мітки даних і теж перетворює їх у такі масиви. Після перетворення, масиви із даними зображень та міток зберігаються у файлах формату `.npy`. Для коректної роботи, скрипт і папка `images` мають знаходитись в одній директорії. В результаті запуску програми, в цій директорії мають з’явитися наступні файли: 
-	`train_images.npy`
-	`train_labels_categorical.npy` 
-	`val_images.npy`
-	`val_labels_categorical.npy`
-	`val_labels_encoded.npy` 
-	`test_images.npy` 
-	`test_labels_encoded.npy`

`train.py` – програма, яка дає можливість створити модель розпізнавання зображень собак вибраних порід. У цій програмі модель створюється з використанням гіперпараметрів, які виявились оптимальними в результаті попередньо проведених досліджень. Ця програма створює мережу заданої конфігурації, навчає, після завершення навчання виводить значення метрик та точність розпізнавання валідаційного набору даних, графік зміни точностей розпізнавання тренувального та валідаційного набору протягом епох навчання, час, витрачений на навчання, в назві графіка, а також дає можливість зберегти навчену модель. Щоб ця програма коректно працювала необхідно спершу запустити скрипт `data_preparation.py`. Також файл `train.py` має знаходитись в одній папці із файлами, отриманими в результаті роботи скрипта `data_preparation.py`. Після запуску програми, користувач має ввести кількість епох, яку навчатиметься модель, після тексту `«Епохи:»`. _Якщо ви використовуєте версію Tensorflow для CPU, не рекомендується вводити число більше 10, оскільки час навчання займе значного часу_. Після введення користувачем кількості епох, модель почне навчання. Модель навчатиметься задану кількість епох. З процесом навчання можна буде спостерігати в командній стрічці. Для навчання модель використовує файли `train_images.npy` та `train_labels_categorical.npy`, для валідації -  `val_images.npy` та `val_labels_categorical.npy`. Після завершення навчання користувачеві буде представлено раніше згаданий графік та метрики. Для обчислення метрик та точності програма використовує файли `val_images.npy`, `val_labels_encoded.npy`. Після того, як користувач ознайомився з результатами навчання та закрив графік, програма запропонує йому зберегти модель. Якщо користувач бажає її зберегти, йому потрібно ввести латинську літеру `«y»`. Після цього йому потрібне ввести назву моделі. Після введення назви та збереження моделі (модель зберігається в директорії, в якій розміщена пограма), в командному рядку з’явиться повідомлення про успішне збереження. Якщо користувач нічого не введе, або ж на попередньому кроці не введе `«y»`, модель не збережеться.

`test.py` – дана програма присвячена для перевірки моделі вже навченої та збереженої моделі. Перевірка здійснюється шляхом розпізнавання моделі тестувального набору даних. Для цього `test.py` використовує файли `test_images.npy` та `test_labels_encoded.npy`. Для коректної роботи програма має знаходитись в одній директорії із цими файлами та файлом моделі (в тому числі і моделі `model.h5`, яка використовується за замовчуванням). В результаті перевірки в командний рядок виводяться метрики розпізнавання і точність. Також відкривається вікно із матрицею помилок, на якій можна оцінити, до яких класів модель віднесла зображення. Після запуску програма «запитає» у користувача, чи він хоче оцінити результати іншої моделі. Якщо так, користувачеві необхідно ввести латинську літеру `«y»`, після чого йому потірбно ввести назву моделі, яку він хоче оцінити. У разі іншого вводу або неправильно введеної назви, програма виведе результати розпізнавання моделі `model.h5`.

`interface.py` – ппрограма, яка забезпечує графічний інтерфейс користувачеві для практичного застосування моделі. Вона дає можливість користувачеві обрати зображення на своєму пристрої, і отримати інформацію про імовірності приналежності зображеної собаки до кожної породи. За замовчуванням, програма використовує модель `model.h5`, однак дає можливість обрати іншу модель. Для можливості використання моделі `model.h5`, файл програми та моделі мають знаходитись в одній директорії. Щоб обрати іншу модель треба натиснути кнопку `«Обрати іншу модель»` у лівому нижньому куті вікна. Після цього користувачеві відкриється діалогове вікно файлової системи, де користувач зможе знайти та обрати потрібний файл моделі зі свого комп’ютера. Серед файлів проекту є файл `not_optimal_model.h5`, який містить модель навчену з використанням неоптимальних гіперпараметрів. Саме його можна і використати для перевірки роботи. Для вибору зображення, потрібно натиснути кнопку `«Обрати зображення»` у верхньому лівому куті. Після цього відкриється діалогове вікно файлової системи, де користувач зможе знайти та обрати зображення, яке він хоче розпізнати. Обране зображення буде відображено у вікні інтерфейсу програми. Щоб модель розпізнала обране зображенння, необхідно натиснути кнопку `«Яка це порода?»`. Після мітки `«Порода:»` з’явиться імовірність та порода, імовірність приналежності до якої є найвищою. Також з’являться значення імовірностей приналежності до інших порід після мітки `«Імовірності приналежності до породи»`.

`model.h5` – це файл, що містить збережену модель згорткової нейронної мережі, яка була навчена з використанням оптимальних гіперпараметрів, виявлених в результаті дослідження. Цей файл зберігає архітектуру моделі, її ваги та параметри, що дозволяє використовувати модель для передбачень без необхідності повторного навчання. 

`not_optimal_model.h5` – це файл, у якому збережена модель згорткової нейронної мережі, навченої з використанням неоптимальних гіперпараметрів. Результати роботи скриптів `test.py` та `interface.py` із цією моделлю можна використати для порівняння з результатами, отриманими під час запуску цих скриптів із використанням моделі з файлу `model.h5`.


## Як запустити програми

Робота виконувалась на операційній системі Windows, тому подальші інструкції стосуються саме запуску на цій системі. 

### Запуск програм із використанням Tensorflow-GPU (Anaconda)
_Рекомендовано_

Для оптимального використання ресурсів і, відповідно, пришвидшення навчання нейронних мереж, використовувалась версія Tensorflow для графічного процесора. Використання саме цієї версії є важливим, якщо Ви бажаєте перевірити роботу файлу `train.py` використовуючи велику кількість епох в рамках розумних часових меж. Для коректної роботи цієї версії необхідно встановити спеціалізовані бібліотеки NVIDIA, а саме `cuDNN` та `CUDA`. Крім того Вам необхідно мати графічний процесор від Nvidia, яка підтримує ці бібліотеки. [Список графічних процесорів](https://developer.nvidia.com/cuda-gpus), які підтримують  `cuDNN` та `CUDA`. 
Оскільки практична частина роботи виконувалась на обчислювальній системі із операційною системою Windows, то вимоги до версій Python та бібліотек наступні:
- Python 3.10 
- TensorFlow-GPU 2.10.0 
- NVIDIA CUDA Toolkit 11.2
- NVIDIA cuDNN 8.1

#### Підготовка робочого середовища 
1.	Спершу необхідно оновити драйвери для GPU.  
2.	Завантажте та встановіть [Anaconda](https://www.anaconda.com/download/success). **Важливо**: під час встановлення Anaconda переконайтеся, що вибрали опцію `«Додати Anaconda в PATH»`, що дозволить зручно доступатися до Anaconda через командний рядок.
3.	В командному рядку Windows введіть `conda --version` для перевірки правильності встановлення. Це має вивести встановлену версію.
4.	Створіть середовище Anaconda із потрібною версією Python ввівши в командний рядок `conda create -n <назва_середовища> python=3.10`. Замість `<назва_середовища>` Ви повинні вказати ім’я, яке хочете дати своєму середовищу.
5.	Активуйте створене середовище ввівши `conda activate <назва_середовища>`
6.	Встановіть CUDA та cuDNN необхідних версій у середовище, ввівши `conda install -c conda-forge cudatoolkit=11.2 cudnn=8.1.0`
7.	Оновіть pip: `python -m pip install --upgrade pip`
8.	В командному рядку перейдіть до директорії, в якій знаходяться файли роботи
9.	Встановіть необхідні бібліотеки: `pip install -r requirements.txt`
10.	Тепер Ви можете запускати файли Python з допомогою команди `python <назва_файлу_з_розширенням>`

### Запуск програм із використанням Tensorflow-СPU (без Anaconda)
Якщо Ви не бажаєте встановлювати Anaconda або у вашій системі відсутній графічний процесор Nvidia, який підтримує бібліотеки cuDNN та CUDA, ці програми можна запустити з використанням TensorFlow, налаштованого для роботи на CPU. Однак у такому випадку не рекомендується задавати велику кількість епох для програми `train.py`, оскільки процес навчання може зайняти значний час.
Для запуску TensorFlow із використанням CPU достатньо створити та налаштувати віртуальне середовище Python. 
#### Підготовка робочого середовища 
1.	Завантажте Python версії [3.10](https://www.python.org/downloads/release/python-3100/). 
2.	В командному рядку Windows перейдіть до директорії, в якій знаходяться файли роботи
3.	Створіть віртуальне середовище Python версії 3.10, ввівши команду `py -3.10 -m venv <назва_середовища>`. Замість `<назва_середовища>` Ви повинні вказати ім’я, яке хочете дати своєму середовищу.
4.	Активуйте створене середовище ввівши `<назва_середовища>\Scripts\activate`
5.	Оновіть pip: `python -m pip install --upgrade pip`
6.	Встановіть необхідні бібліотеки: `pip install -r requirements.txt`
7.	Тепер Ви можете запускати файли Python з допомогою команди `python <назва_файлу_з_розширенням>`
